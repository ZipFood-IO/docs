"use strict";(globalThis.webpackChunkzipfood_docs=globalThis.webpackChunkzipfood_docs||[]).push([[1019],{7747:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"Auth Module Documentation 23af6eb935c780988c66ca9ca2f5451b","title":"Auth Module Documentation","description":"Created by: Mark Serbol","source":"@site/docs/Auth Module Documentation 23af6eb935c780988c66ca9ca2f5451b.md","sourceDirName":".","slug":"/Auth Module Documentation 23af6eb935c780988c66ca9ca2f5451b","permalink":"/docs/docs/Auth Module Documentation 23af6eb935c780988c66ca9ca2f5451b","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Auth Module Documentation 23af6eb935c780988c66ca9ca2f5451b.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Tutorial Intro","permalink":"/docs/docs/intro"},"next":{"title":"Orders Module Documentation","permalink":"/docs/docs/Orders Module Documentation 23df6eb935c78059b951f64abfcf7381"}}');var r=s(4848),t=s(8453);const l={},c="Auth Module Documentation",d={},o=[{value:"<strong>Controller Endpoints</strong>",id:"controller-endpoints",level:2},{value:"Implemented Authentication Strategies",id:"implemented-authentication-strategies",level:2},{value:"Authentication Strategies (via Passport.js)",id:"authentication-strategies-via-passportjs",level:3},{value:"<strong>Main Service:\xa0<code>AuthService</code></strong>",id:"main-serviceauthservice",level:2},{value:"Responsibilities",id:"responsibilities",level:3},{value:"Key Methods",id:"key-methods",level:3},{value:"Service Dependencies",id:"service-dependencies",level:3},{value:"Extending/Customizing",id:"extendingcustomizing",level:3}];function a(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"auth-module-documentation",children:"Auth Module Documentation"})}),"\n",(0,r.jsx)(n.p,{children:"Created by: Mark Serbol\nCreated time: July 24, 2025 6:01 PM\nCategory: API Module, Technical\nLast edited by: Mark Serbol\nLast updated time: July 25, 2025 10:06 AM"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"}),"\xa0",(0,r.jsx)(n.code,{children:"src/auth/"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Purpose:"})}),"\n",(0,r.jsx)(n.p,{children:"Handles authentication, registration, password reset, and 2FA (TOTP) for all user types (customer, client, pilot). Integrates with Stripe for wallet/customer creation and supports multiple OAuth strategies."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"controller-endpoints",children:(0,r.jsx)(n.strong,{children:"Controller Endpoints"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Endpoints are documented in Swagger; here is a summary:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/login"}),"\xa0\u2014 User login (JWT)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/logout"}),"\xa0\u2014 User logout"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/register"}),"\xa0\u2014 Register new user (with optional profile/wallet creation)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /auth/user"}),"\xa0\u2014 Get current user info (JWT required)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/otp-setup"}),"\xa0\u2014 Setup TOTP (2FA)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/otp-verify"}),"\xa0\u2014 Verify TOTP token"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/forgot-password"}),"\xa0\u2014 Request password reset"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/reset-password"}),"\xa0\u2014 Reset password"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"POST /auth/check-user"}),"\xa0\u2014 Check if username exists"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /auth/google"}),"\xa0/\xa0",(0,r.jsx)(n.code,{children:"GET /auth/google/callback"}),"\xa0\u2014 Google OAuth login"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /auth/apple"}),"\xa0/\xa0",(0,r.jsx)(n.code,{children:"GET /auth/apple/callback"}),"\xa0\u2014 Apple OAuth login"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"implemented-authentication-strategies",children:"Implemented Authentication Strategies"}),"\n",(0,r.jsx)(n.h3,{id:"authentication-strategies-via-passportjs",children:"Authentication Strategies (via Passport.js)"}),"\n",(0,r.jsxs)(n.p,{children:["All authentication strategies are implemented using\xa0Passport.js\xa0through the\xa0",(0,r.jsx)(n.code,{children:"@nestjs/passport"}),"\xa0integration:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Local Strategy"}),"\xa0(",(0,r.jsx)(n.code,{children:"local.strategy.ts"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Standard username/password authentication."}),"\n",(0,r.jsxs)(n.li,{children:["Used for login via\xa0",(0,r.jsx)(n.code,{children:"/auth/login"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JWT Strategy"}),"\xa0(",(0,r.jsx)(n.code,{children:"jwt.strategy.ts"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Secures endpoints using JSON Web Tokens."}),"\n",(0,r.jsxs)(n.li,{children:["Used for protected routes (e.g.,\xa0",(0,r.jsx)(n.code,{children:"/auth/user"}),")."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Google OAuth Strategy"}),"\xa0(",(0,r.jsx)(n.code,{children:"google-oauth.strategy.ts"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Allows users to authenticate via Google accounts."}),"\n",(0,r.jsxs)(n.li,{children:["Endpoints:\xa0",(0,r.jsx)(n.code,{children:"/auth/google"}),",\xa0",(0,r.jsx)(n.code,{children:"/auth/google/callback"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Apple OAuth Strategy"}),"\xa0(",(0,r.jsx)(n.code,{children:"apple-oauth.strategy.ts"}),")","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Allows users to authenticate via Apple ID."}),"\n",(0,r.jsxs)(n.li,{children:["Endpoints:\xa0",(0,r.jsx)(n.code,{children:"/auth/apple"}),",\xa0",(0,r.jsx)(n.code,{children:"/auth/apple/callback"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"main-serviceauthservice",children:(0,r.jsxs)(n.strong,{children:["Main Service:\xa0",(0,r.jsx)(n.code,{children:"AuthService"})]})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"}),"\xa0",(0,r.jsx)(n.code,{children:"src/auth/auth.service.ts"})]}),"\n",(0,r.jsx)(n.h3,{id:"responsibilities",children:"Responsibilities"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Validation & Login:"})}),"\n",(0,r.jsx)(n.p,{children:"Validates credentials and issues JWT tokens."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Registration:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creates user record."}),"\n",(0,r.jsxs)(n.li,{children:["Creates associated profile (customer, client, pilot) via\xa0",(0,r.jsx)(n.code,{children:"ProfileService"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"For customers/pilots: creates Stripe wallet account and updates profile."}),"\n",(0,r.jsx)(n.li,{children:"For clients: creates Stripe customer and updates profile."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2FA (TOTP):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Generates TOTP secret and token."}),"\n",(0,r.jsx)(n.li,{children:"Saves TOTP secret (prevents rapid re-creation)."}),"\n",(0,r.jsx)(n.li,{children:"Verifies TOTP token for login/registration."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Password Reset:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Generates and stores reset token with expiration."}),"\n",(0,r.jsx)(n.li,{children:"Validates and updates password using the token."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"OAuth Support:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Integrates with Google and Apple OAuth strategies for social login."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"key-methods",children:"Key Methods"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"validateUser(username, password)"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Returns user if credentials are valid."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"login(user)"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Returns JWT access token."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"register(data, ip, createProfile, createWalletAccount)"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Transactionally creates user, profile, and wallet/Stripe account as needed."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"generateTotpSecret()"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Generates a new TOTP secret and initial token."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"saveTotpSecret(username, secret)"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Stores TOTP secret, ensuring no recent token exists."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"verifyTotp(username, token)"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Verifies a TOTP token for a user."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"forgotPassword(username)"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Generates a password reset token and sets expiration."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"resetPassword(userId, token, password)"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Validates token and updates user password."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-dependencies",children:"Service Dependencies"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"UsersService"}),": User CRUD and lookup."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ProfileService"}),": Profile creation and updates."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WalletService"}),": Stripe wallet/account creation."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"PrismaService"}),": Direct DB access and transactions."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stripe"}),": Stripe API for customer/wallet management."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"extendingcustomizing",children:"Extending/Customizing"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add new OAuth providers by implementing new strategy classes and updating the module."}),"\n",(0,r.jsxs)(n.li,{children:["Add new user types by updating profile creation logic in\xa0",(0,r.jsx)(n.code,{children:"createProfile"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Adjust password/2FA policies as needed in service methods."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);