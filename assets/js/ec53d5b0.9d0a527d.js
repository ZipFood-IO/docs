"use strict";(globalThis.webpackChunkzipfood_docs=globalThis.webpackChunkzipfood_docs||[]).push([[5504],{5468:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"Wallet Module Documentation 23df6eb935c780d3a33cc8602aec178d","title":"Wallet Module Documentation","description":"Created by: Mark Serbol","source":"@site/docs/Wallet Module Documentation 23df6eb935c780d3a33cc8602aec178d.md","sourceDirName":".","slug":"/Wallet Module Documentation 23df6eb935c780d3a33cc8602aec178d","permalink":"/docs/docs/Wallet Module Documentation 23df6eb935c780d3a33cc8602aec178d","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Wallet Module Documentation 23df6eb935c780d3a33cc8602aec178d.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Users Module Documentation","permalink":"/docs/docs/Users Module Documentation 23bf6eb935c78097bcc4f381ea42f1af"},"next":{"title":"ZIPFood Client Onboarding Guide","permalink":"/docs/docs/ZIPFood Client Onboarding Guide 239f6eb935c780289390eb98656f3459"}}');var i=s(4848),l=s(8453);const c={},r="Wallet Module Documentation",d={},a=[{value:"<strong>Purpose</strong>",id:"purpose",level:2},{value:"<strong>Controller Endpoints</strong>",id:"controller-endpoints",level:2},{value:"<strong>Main Service:\xa0<code>WalletService</code></strong>",id:"main-servicewalletservice",level:2},{value:"Responsibilities",id:"responsibilities",level:3},{value:"Key Methods",id:"key-methods",level:3},{value:"<strong>Security Review</strong>",id:"security-review",level:2},{value:"<strong>Extending/Customizing</strong>",id:"extendingcustomizing",level:2}];function o(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"wallet-module-documentation",children:"Wallet Module Documentation"})}),"\n",(0,i.jsx)(n.p,{children:"Created by: Mark Serbol\nCreated time: July 27, 2025 9:22 AM\nCategory: API Module, Technical\nLast edited by: Mark Serbol\nLast updated time: July 27, 2025 9:30 AM"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location:"}),"\xa0",(0,i.jsx)(n.code,{children:"src/wallet/"})]}),"\n",(0,i.jsx)(n.h2,{id:"purpose",children:(0,i.jsx)(n.strong,{children:"Purpose"})}),"\n",(0,i.jsx)(n.p,{children:"Manages user wallet operations, Stripe account integration, payouts, payments, earnings, and external accounts (bank/card). Handles all financial interactions for users (customers, pilots)."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"controller-endpoints",children:(0,i.jsx)(n.strong,{children:"Controller Endpoints"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["All endpoints require JWT authentication (",(0,i.jsx)(n.code,{children:"@UseGuards(JwtAuthGuard)"}),")."]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /wallet/accounts"}),"\xa0\u2014 Create Stripe account for user"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PATCH /wallet/accounts"}),"\xa0\u2014 Update Stripe account"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PATCH /wallet/accounts/payout-schedule"}),"\xa0\u2014 Update Stripe payout schedule"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /wallet/accounts"}),"\xa0\u2014 Get Stripe account details"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /wallet/payout-accounts"}),"\xa0\u2014 Add payout (bank/card) account"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /wallet/payout-accounts"}),"\xa0\u2014 List payout accounts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DELETE /wallet/payout-accounts/:id"}),"\xa0\u2014 Delete payout account"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PATCH /wallet/payout-accounts/:id"}),"\xa0\u2014 Update payout account"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /wallet/accept-payment"}),"\xa0\u2014 Accept payment (creates PaymentIntent)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /wallet/balance"}),"\xa0\u2014 Get Stripe account balance"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /wallet/payouts"}),"\xa0\u2014 Request payout"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /wallet/payouts"}),"\xa0\u2014 List all user payouts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /wallet/payments"}),"\xa0\u2014 List all payments received"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /wallet/earnings"}),"\xa0\u2014 Get earnings by date range"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /wallet/earnings-summary"}),"\xa0\u2014 Get earnings summary"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /wallet/test/add-charge"}),"\xa0\u2014 Add test charge (for development)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"main-servicewalletservice",children:(0,i.jsxs)(n.strong,{children:["Main Service:\xa0",(0,i.jsx)(n.code,{children:"WalletService"})]})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Location:"}),"\xa0",(0,i.jsx)(n.code,{children:"src/wallet/wallet.service.ts"})]}),"\n",(0,i.jsx)(n.h3,{id:"responsibilities",children:"Responsibilities"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Stripe Account Management:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create, update, retrieve Stripe accounts for users."}),"\n",(0,i.jsx)(n.li,{children:"Link Stripe account to user profile."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"External Account Management:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Add, list, update, delete bank/card accounts for payouts."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Payments & Payouts:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create payment intents for accepting payments."}),"\n",(0,i.jsx)(n.li,{children:"Request payouts, ensuring sufficient balance."}),"\n",(0,i.jsx)(n.li,{children:"List payouts and payments."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Earnings & Balance:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Retrieve Stripe account balance."}),"\n",(0,i.jsx)(n.li,{children:"Get earnings by date range and summary (today, week, month, year, all time)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Security & Validation:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All operations validate user identity via JWT."}),"\n",(0,i.jsx)(n.li,{children:"All Stripe operations check that the user\u2019s profile and wallet account exist."}),"\n",(0,i.jsx)(n.li,{children:"Payout requests check for sufficient funds."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"key-methods",children:"Key Methods"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"createStripeAccount(user, ip?)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"updateStripeAccount(userId, data)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"getStripeAccount(userId)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"addExternalAccount(userId, accountToken, isDefault?)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"getExternalAccounts(userId)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"deleteExternalAccount(userId, accountId)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"updateExternalAccount(userId, accountId, data)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"createPaymentIntent(paymentDetails)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"getBalance(userId)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"requestPayout(payoutRequest, userId)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"listPayouts(userId)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"listPayments(userId)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"getEarnings(userId, from?, to?)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"getEarningsSummary(userId)"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"security-review",children:(0,i.jsx)(n.strong,{children:"Security Review"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Authentication:"})}),"\n",(0,i.jsx)(n.p,{children:"All endpoints require JWT; only logged-in users can access wallet features."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Authorization:"})}),"\n",(0,i.jsxs)(n.p,{children:["All operations are scoped to the authenticated user (",(0,i.jsx)(n.code,{children:"authUser.id"}),")."]}),"\n",(0,i.jsx)(n.p,{children:"Stripe account and external account actions always check that the user owns the account."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Payout requests check for sufficient available balance."}),"\n",(0,i.jsx)(n.li,{children:"All Stripe operations validate existence of wallet account in user profile."}),"\n",(0,i.jsx)(n.li,{children:"Bank/card account deletion checks that the account exists and is not the only default."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"No direct access to other users\u2019 financial data or accounts."})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"extendingcustomizing",children:(0,i.jsx)(n.strong,{children:"Extending/Customizing"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Add new payout/payment methods by extending service and controller."}),"\n",(0,i.jsx)(n.li,{children:"Integrate additional financial providers as needed."}),"\n",(0,i.jsx)(n.li,{children:"Add admin endpoints for global financial reporting if required (with strict role checks)."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>r});var t=s(6540);const i={},l=t.createContext(i);function c(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);